
      
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المستخدمين</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            direction: rtl;
            background: linear-gradient(to right, #f9e7e7, #e3f7f7);
            color: #333;
            margin: 0;
            padding-top: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .container {
          
            width: 40%;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        input, select, button {
            width: 90%;
            margin: 10px;
            padding: 12px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ddd;
            transition: 0.3s;
        }
        button {
            background: #5a9;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover { background: #48a; }
        .hidden { display: none; }
   table{width:100%;}
    </style>
</head>
<body >
    
    <!-- صفحة التسجيل -->
    <div id="registerPage" class="container">
        <h2>تسجيل جديد</h2>
        <input type="text" id="regName" placeholder="الاسم" onclick="checkAdminExists()">
        <input type="password" id="regPass" placeholder="كلمة المرور">
        <input type="password" id="regPassConfirm" placeholder="تأكيد كلمة المرور">
       <!-- <label><input type="checkbox" id="isAdmin"> تسجيل كمشرف</label>-->
        <button onclick="register()">تسجيل</button>
        <p>لديك حساب؟ <a href="#" onclick="showLogin()">سجل دخول</a></p>
    </div>
    
    <!-- صفحة تسجيل الدخول -->
    <div id="loginPage" class="container hidden">
        <h2>تسجيل الدخول</h2>
        <input type="text" id="loginName" placeholder="الاسم">
        <input type="password" id="loginPass" placeholder="كلمة المرور">
        <button onclick="login()">دخول</button>
        <p>ليس لديك حساب؟ <a href="#" onclick="showRegister()">سجل جديد</a></p>
    </div>
    
    <!-- صفحة المشرف -->
   <div id="adminPage" class="container hidden">
        <h2>مرحبًا مشرف النظام!</h2>
        <button onclick="logout()">تسجيل خروج</button>
        <h3>إدارة المستخدمين</h3>
       <!--  <select id="userDeleteSelect"></select>
        <button onclick="deleteSelectedUser()">حذف المستخدم المحدد</button>-->
        <h3>إضافة مهمة للمستخدم</h3>
         <select id="userTaskSelect"></select>
        <input type="text" id="taskText" placeholder="المهمة">
        <input type="text" id="positiveNote" placeholder="الملاحظات الإيجابية">
        <input type="text" id="negativeNote" placeholder="الملاحظات السلبية">
        <button onclick="addTask()">إضافة المهمة</button>
        <h3>جدول المهام</h3>
        <table border="1" id="taskTable">
            <thead>
                <tr>
                    <th>التاريخ</th>
                    <th>الاسم</th>
                    <th>المهمة</th>
                    <th>الملاحظات الإيجابية</th>
                    <th>الملاحظات السلبية</th>
                    <th>إجراءات</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <!-- صفحة المستخدم -->
    <div id="userPage" class="container hidden">
        <h2>مرحبًا بك!</h2>
        <button onclick="logout()">تسجيل خروج</button>
        <h3>مهامك اليومية</h3>
        <table border="1" id="userTaskTable">
            <thead>
                <tr>
                    <th>التاريخ</th>
                    <th>المهمة</th>
                    <th>الملاحظات الإيجابية</th>
                    <th>الملاحظات السلبية</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <script>





                       


     async function loadUsersIntoSelect() {
            try {
                let response = await fetch("https://task-management-8q4e.onrender.com/users");
                let users = await response.json();
               
                let userTaskSelect = document.getElementById("userTaskSelect");
            
                userTaskSelect.innerHTML = "";
                
                users.forEach(user => {
                   
                    
                    let optionTask = document.createElement("option");
                    optionTask.value = user.name; 
                    optionTask.textContent = user.name;
                    userTaskSelect.appendChild(optionTask);
                });
            } catch (error) {
                console.error("❌ خطأ في تحميل المستخدمين:", error);
            }
        }
        
      
            
  
    


    async function register() {
        let name = document.getElementById("regName").value.trim();
        let pass = document.getElementById("regPass").value.trim();
        let passConfirm = document.getElementById("regPassConfirm").value.trim();
        
        if (!name || !pass || pass !== passConfirm) {
            alert("⚠️ يرجى إدخال البيانات بشكل صحيح والتأكد من تطابق كلمة المرور!");
            return;
        }

        let newUser = { name, password: pass, isAdmin: false }; // افتراضيًا جميع المستخدمين ليسوا مشرفين

        let response = await fetch("https://task-management-8q4e.onrender.com/users", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(newUser)
        });
	
           





        if (response.ok) {
            alert("✅ تم تسجيل المستخدم بنجاح! يمكنك الآن تسجيل الدخول.");
            showLogin();
        } else {
            alert("❌ خطأ في التسجيل.");
        }
    }

    async function login() {
        let name = document.getElementById("loginName").value.trim();
        let pass = document.getElementById("loginPass").value.trim();

        try {
            let response = await fetch("https://task-management-8q4e.onrender.com/users");
            let users = await response.json();

            let user = users.find(user => user.name === name && user.password === pass);

            if (!user) {
                alert("❌ بيانات غير صحيحة، يرجى التأكد من الاسم وكلمة المرور.");
                return;
            }
            
            currentUser = user.name;
            console.log("🔹 المستخدم الحالي:", currentUser);

            if (user.isAdmin) {
                alert(`🔹 مرحبًا ${name}! لقد سجلت الدخول كمشرف.`);
                showAdmin();
            } else {
                alert(`👋 مرحبًا ${name}! لقد سجلت الدخول كمستخدم عادي.`);
                showUser();
            }
        } catch (error) {
            console.error("❌ حدث خطأ أثناء تسجيل الدخول:", error);
            alert("❌ لا يمكن الاتصال بالخادم.");
        }
    }

   async function addTask() {
  let user = document.getElementById("userTaskSelect").value;
    let task = document.getElementById("taskText").value;
    let positiveNote = document.getElementById("positiveNote").value;
    let negativeNote = document.getElementById("negativeNote").value;
    let newTask = { user, task, positiveNote, negativeNote, date: new Date().toISOString().split('T')[0] };

    let response = await fetch("https://task-management-8q4e.onrender.com/tasks", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newTask)
    });

    if (response.ok) {
        loadTasks();
    }
}

    async function loadTasks() {
        let response = await fetch("https://task-management-8q4e.onrender.com/tasks");
        let tasks = await response.json();
        let tableBody = document.querySelector("#taskTable tbody");
        tableBody.innerHTML = tasks.map((task, index) => `
            <tr>
                <td>${task.date}</td>
                <td>${task.user}</td>
                <td>${task.task}</td>
                <td>${task.positiveNote}</td>
                <td>${task.negativeNote}</td>
                <td>
                    <button onclick="deleteTask('${task.id}')">حذف</button>
                </td>
            </tr>
        `).join('');
    }

    async function deleteTask(taskId) {
        await fetch(`https://task-management-8q4e.onrender.com/tasks/${taskId}`, { method: "DELETE" });
        loadTasks();
    }

    function showLogin() {
        document.getElementById("registerPage").classList.add("hidden");
        document.getElementById("loginPage").classList.remove("hidden");
    }

    function showRegister() {
        document.getElementById("registerPage").classList.remove("hidden");
        document.getElementById("loginPage").classList.add("hidden");
    }

    function showAdmin() {
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("adminPage").classList.remove("hidden");
        loadUsersIntoSelect();
        loadTasks();
    }

    function showUser() {
        document.getElementById("loginPage")?.classList.add("hidden");
        document.getElementById("userPage").classList.remove("hidden");
        setTimeout(loadUserTasks, 500);
    }

    async function loadUserTasks() {
        try {
            let response = await fetch("https://task-management-8q4e.onrender.com/tasks");
            let tasks = await response.json();
            let userTasks = tasks.filter(task => task.user === currentUser);
            
            let tableBody = document.querySelector("#userTaskTable tbody");
            tableBody.innerHTML = userTasks.length > 0 ? userTasks.map(task => `
                <tr>
                    <td>${task.date}</td>
                    <td>${task.task}</td>
                    <td>${task.positiveNote}</td>
                    <td>${task.negativeNote}</td>
                </tr>
            `).join('') : "<tr><td colspan='4'>لا توجد مهام حاليًا</td></tr>";
        } catch (error) {
            console.error("❌ خطأ في تحميل المهام:", error);
        }
    }

    function logout() { location.reload(); }

    window.onload = function() {
       loadUsersIntoSelect();
            loadTasks();
      
    };


    </script>
</body>
</html>
